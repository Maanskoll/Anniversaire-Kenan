<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Accès secret — Station 10</title>
  <style>
    :root{--bg:#0b0b0f;--card:#0f1720;--accent:#7dd3fc;--muted:#94a3b8}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;background:linear-gradient(180deg,#020617 0%, #081025 100%);color:#e6eef6}
    .wrap{max-width:720px;margin:6vh auto;padding:28px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;box-shadow:0 8px 30px rgba(2,6,23,0.6)}
    h1{margin:0 0 10px;font-size:20px}
    p{color:var(--muted);margin:6px 0 18px}
    input[type="password"]{width:100%;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit;font-size:16px}
    button{margin-top:12px;padding:10px 14px;border-radius:8px;border:0;background:var(--accent);color:#012;cursor:pointer;font-weight:600}
    .hint{font-size:13px;color:#9fb8c9;margin-top:8px}
    .player{margin-top:18px}
    .hidden{display:none}
    .small{font-size:13px;color:var(--muted)}
    .danger{color:#ffb4b4}
    .actions{display:flex;gap:8px;margin-top:12px}
    .link{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:8px;color:var(--accent);cursor:pointer}
  </style>
</head>
<body>
  <div class="wrap" role="main">
    <h1>Accès secret — Station X</h1>
    <p>Entre le mot‑de‑passe découvert pour débloquer la transmission. </p>

    <label for="pw">Mot de passe :</label>
    <input id="pw" type="password" inputmode="text" autocomplete="off" placeholder="Mot de passe" />
    <div class="actions">
      <button id="check">Valider</button>
      <button id="useRedirect" class="link">Rediriger vers l'URL</button>
    </div>

    <div id="message" class="hint"></div>

    <!-- Zone cachée qui sera révélée après mot de passe correct -->
    <div id="reveal" class="player hidden" aria-hidden="true">
      <p class="small">Transmission disponible </p>
      <!-- Exemple: fichier statique placé dans /audio/latitude_morse.wav -->
      <audio id="audioPlayer" controls preload="auto">
        <source src="audio/Piste1.wav" type="audio/wav">
        Votre navigateur ne supporte pas l'élément audio.
      </audio>

      <p class="small">Astuce : utilise le bouton lecture pour répéter, ou se rendre sur l'URL. </p>
      <div id="qr" style="margin-top:12px"></div>

  <script>
    // ---------- CONFIG ----------
    // mot de passe (côté client) — change avant déploiement
    const PASSWORD_HASH = '9147343d9851d9a4727fab30d6594b416109e55a'; // SHA-1 example of 'morse47' (illustration)

    // ---------- UTIL - SHA1 léger (pour éviter mot en clair dans HTML) ----------
    // Note : SHA1 côté client n'est pas une protection réelle, juste un obstacle minime.
    async function sha1(message) {
      const enc = new TextEncoder();
      const data = enc.encode(message);
      const hashBuffer = await crypto.subtle.digest('SHA-1', data);
      const hashArray = Array.from(new Uint8Array(hashBuffer));
      return hashArray.map(b => b.toString(16).padStart(2,'0')).join('');
    }

    const elPw = document.getElementById('pw');
    const btn = document.getElementById('check');
    const msg = document.getElementById('message');
    const reveal = document.getElementById('reveal');
    const audio = document.getElementById('audioPlayer');
    const btnRedirect = document.getElementById('useRedirect');

    btn.addEventListener('click', async () => {
      const val = elPw.value.trim();
      if (!val) { msg.textContent = 'Entre quelque chose...'; return; }
      msg.textContent = 'Vérification...';
      const h = await sha1(val);
      if (h === PASSWORD_HASH) {
        // succès : révèle la zone
        reveal.classList.remove('hidden');
        reveal.setAttribute('aria-hidden','false');
        msg.textContent = 'Accès accordé — écoutez.';
        // autoplay optionnel (potentiellement bloqué par navigateur)
        try { audio.play(); } catch(e){}
      } else {
        msg.textContent = 'Mot de passe incorrect.';
      }
    });

    // Redirection vers URL (utile si tu veux pointer vers un flux Icecast par ex.)
    btnRedirect.addEventListener('click', () => {
      if (!REDIRECT_URL) {
        alert('Aucun REDIRECT_URL configuré dans le code.');
        return;
      }
      // Option : on peut d'abord demander le mot; ici on redirige directement.
      window.location.href = REDIRECT_URL;
    });

  </script>
</body>
</html>

